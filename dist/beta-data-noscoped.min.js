/*!
betajs-data - v1.0.0 - 2015-06-10
Copyright (c) Oliver Friedmann
MIT Software License.
*/
(function(){var a=this.subScope();a.binding("module","global:BetaJS.Data"),a.binding("base","global:BetaJS"),a.binding("json","global:JSON"),a.define("module:",function(){return{guid:"70ed7146-bb6d-4da4-97dc-5a8e2d23a23f",version:"28.1433977762202"}}),a.define("module:Queries.Constrained",["json:","module:Queries","base:Types","base:Objs","base:Tokens","base:Comparators"],function(a,b,c,d,e){return{rectify:function(a){var b="options"in a||"query"in a?a:{query:a};return d.extend({query:{},options:{}},b)},skipValidate:function(a,b){return"skip"in a&&b?b.skip:!0},limitValidate:function(a,b){return"limit"in a&&b?b.limit:!0},sortValidate:function(a,b){if("sort"in a){if(b&&!b.sort)return!1;if(b&&c.is_object(b.sort)){var e=d.all(a.sort,function(a,c){return c in b.sort});if(!e)return!1}}return!0},constraintsValidate:function(a,b){return d.all(["skip","limit","sort"],function(c){return this[c+"Validate"].call(this,a,b)},this)},validate:function(a,c){return a=this.rectify(a),this.constraintsValidate(a.options,c)&&b.validate(a.query,c.query||{})},fullConstrainedQueryCapabilities:function(a){return{query:a||b.fullQueryCapabilities(),skip:!0,limit:!0,sort:!0}},normalize:function(a){return a=this.rectify(a),{query:b.normalize(a.query),options:a.options}},serialize:function(b){return a.stringify(this.rectify(b))},unserialize:function(b){return a.parse(b)},hash:function(a){return e.simple_hash(this.serialize(a))},subsumizes:function(c,d){c=this.rectify(c),d=this.rectify(d);var e=c.options.skip||0,f=d.options.skip||0,g=c.options.limit||null,h=d.options.limit||null,i=c.options.sort,j=c.options.sort;if(e>f)return!1;if(g){if(!h)return!1;if(h+f>g+e)return!1}return(e||g)&&(i||j)&&a.stringify(i)!=a.stringify(j)?!1:b.subsumizes(c.query,d.query)},mergeable:function(c,d){if(c=this.rectify(c),d=this.rectify(d),b.serialize(c.query)!=b.serialize(d.query))return!1;var e=c.options,f=d.options;return a.stringify(e.sort||{})!=a.stringify(f.sort||{})?!1:"skip"in e?"skip"in f?e.skip<=f.skip?!e.limit||e.skip+e.limit>=f.skip:!f.limit||f.skip+f.limit>=e.skip:!f.limit||f.limit>=e.skip:!("skip"in f)||!e.limit||e.limit>=f.skip},merge:function(a,b){a=this.rectify(a),b=this.rectify(b);var c=a.options,d=b.options;return{query:a.query,options:{skip:"skip"in c&&"skip"in d?Math.min(c.skip,d.skip):null,limit:"limit"in c&&"limit"in d?Math.max(c.limit,d.limit):null,sort:a.sort}}}}}),a.define("module:Queries",["json:","base:Types","base:Sort","base:Objs","base:Class","base:Tokens","base:Iterators.ArrayIterator","base:Iterators.FilteredIterator","base:Strings","base:Comparators"],function(a,b,c,d,e,f,g,h,i,j){var k={$or:{evaluate_combine:d.exists},$and:{evaluate_combine:d.all}},l={$in:{target:"atoms",evaluate_combine:d.exists,evaluate_single:function(a,b){return a===b}},$gt:{target:"atom",evaluate_single:function(a,b){return a>b}},$lt:{target:"atom",evaluate_single:function(a,b){return b>a}},$gte:{target:"atom",evaluate_single:function(a,b){return a>=b}},$le:{target:"atom",evaluate_single:function(a,b){return b>=a}},$sw:{target:"atom",evaluate_single:function(a,c){return a===c||b.is_string(a)&&0===a.indexOf(c)}},$ct:{target:"atom",no_index_support:!0,evaluate_single:function(a,c){return a===c||b.is_string(a)&&a.indexOf(c)>=0}},$eq:{target:"atom",evaluate_single:function(a,b){return a===b}}};return d.iter(d.clone(l,1),function(a,b){var c=d.clone(a,1);c.evaluate_single=function(b,c){return a.evaluate_single(b.toLowerCase(),c.toLowerCase())},c.ignore_case=!0,l[b+"ic"]=c}),{SYNTAX_PAIR_KEYS:k,SYNTAX_CONDITION_KEYS:l,validate:function(a,b){return this.validate_query(a,b)},validate_atoms:function(a,c){return b.is_array(a)&&d.all(a,function(a){return this.validate_atom(a,c)},this)},validate_atom:function(a,b){return!b||!!b.atom},validate_queries:function(a,c){return b.is_array(a)&&d.all(a,function(a){return this.validate_query(a,c)},this)},validate_query:function(a,c){return b.is_object(a)&&d.all(a,function(a,b){return this.validate_pair(a,b,c)},this)},validate_pair:function(a,b,c){return b in this.SYNTAX_PAIR_KEYS?!c||c.bool&&b in c.bool?this.validate_queries(a,c):!1:this.validate_value(a,c)},is_query_atom:function(a){return null===a||!b.is_object(a)||d.all(a,function(a,b){return!(b in this.SYNTAX_CONDITION_KEYS)},this)},validate_value:function(a,b){return this.is_query_atom(a)?this.validate_atom(a,b):this.validate_conditions(a,b)},validate_conditions:function(a,c){return b.is_object(a)&&d.all(a,function(a,b){return this.validate_condition(a,b,c)},this)},validate_condition:function(a,b,c){if(!(!c||c.conditions&&b in c.conditions))return!1;var d=this.SYNTAX_CONDITION_KEYS[b];return d&&("atoms"===d.target?this.validate_atoms(a):this.validate_atom(a))},normalize:function(a){return c.deep_sort(a)},serialize:function(b){return a.stringify(b)},unserialize:function(b){return a.parse(b)},hash:function(a){return f.simple_hash(this.serialize(a))},dependencies:function(a){return d.keys(this.dependencies_query(a,{}))},dependencies_queries:function(a,b){return d.iter(a,function(a){b=this.dependencies_query(a,b)},this),b},dependencies_query:function(a,b){return d.iter(a,function(a,c){b=this.dependencies_pair(a,c,b)},this),b},dependencies_pair:function(a,b,c){return b in this.SYNTAX_PAIR_KEYS?this.dependencies_queries(a,c):this.dependencies_key(b,c)},dependencies_key:function(a,b){return b[a]=(b[a]||0)+1,b},evaluate:function(a,b){return this.evaluate_query(a,b)},evaluate_query:function(a,b){return d.all(a,function(a,c){return this.evaluate_pair(a,c,b)},this)},evaluate_pair:function(a,b,c){return b in this.SYNTAX_PAIR_KEYS?this.SYNTAX_PAIR_KEYS[b].evaluate_combine.call(d,a,function(a){return this.evaluate_query(a,c)},this):this.evaluate_value(a,c[b])},evaluate_value:function(a,b){return this.is_query_atom(a)?this.evaluate_atom(a,b):this.evaluate_conditions(a,b)},evaluate_atom:function(a,b){return a===b},evaluate_conditions:function(a,b){return d.all(a,function(a,c){return this.evaluate_condition(a,c,b)},this)},evaluate_condition:function(a,b,c){var e=this.SYNTAX_CONDITION_KEYS[b];return"atoms"===e.target?e.evaluate_combine.call(d,a,function(a){return e.evaluate_single.call(this,c,a)},this):e.evaluate_single.call(this,c,a)},subsumizes:function(a,c){if(!b.is_object(a)||!b.is_object)return a==c;for(var d in a)if(!(d in c&&this.subsumizes(a[d],c[d])))return!1;return!0},fullQueryCapabilities:function(){var a={};d.iter(this.SYNTAX_PAIR_KEYS,function(b,c){a[c]=!0});var b={};return d.iter(this.SYNTAX_CONDITION_KEYS,function(a,c){b[c]=!0}),{atom:!0,bool:a,conditions:b}},mergeConditions:function(a,c){b.is_object(a)||(a={$eq:a}),b.is_object(c)||(c={$eq:c});var e=!1,f=d.clone(a,1);return d.iter(c,function(a,b){if(e)return!1;if(b in f){var c=f[b];i.starts_with(b,"$eq")&&(e=!0),i.starts_with(b,"$in")&&(c=d.objectify(c),f[b]=[],e=!0,d.iter(a,function(a){c[a]&&(f[b].push(a),e=!1)})),i.starts_with(b,"$sw")&&(i.starts_with(c,a)?f[b]=a:i.starts_with(a,c)||(e=!0)),i.starts_with(b,"$gt")&&j.byValue(c,a)<0&&(f[b]=a),i.starts_with(b,"$lt")&&j.byValue(c,a)>0&&(f[b]=a)}else f[b]=a},this),e&&(f={$in:[]}),f},disjunctiveNormalForm:function(a,b){a=d.clone(a,1);var c=[];if(a.$or){var e=[];d.iter(a.$or,function(a){d.iter(this.disjunctiveNormalForm(a,b).$or,function(a){e.push(a)},this)},this),c.push(e),delete a.$or}a.$and&&(d.iter(a.$and,function(a){var e=[];d.iter(this.disjunctiveNormalForm(a,b).$or,function(a){e.push(a)},this),c.push(e)},this),delete a.$and);var f=[],g=function(a,e){e<c.length?d.iter(c[e],function(c){var f=d.clone(a,1);d.iter(c,function(a,c){c in f?b?f[c]=this.mergeConditions(f[c],a):(f.$and||(f.$and=[]),f.$and.push(d.objectBy(c,a))):f[c]=a},this),g(f,e+1)},this):f.push(a)};return g(a,0),{$or:f}},simplifyQuery:function(a){var c={};return d.iter(a,function(a,e){if(e in this.SYNTAX_PAIR_KEYS){var f=[],g=!1;d.iter(a,function(a){var c=this.simplifyQuery(a);b.is_empty(c)?g=!0:f.push(c)},this),("$and"===e&&f.length>0||"$or"===e&&!g)&&(c[e]=f)}else{var h=this.simplifyConditions(a);b.is_empty(h)||(c[e]=h)}},this),c},simplifyConditions:function(a){var b={};return d.iter(["","ic"],function(c){if(a["$eq"+c]||a["$in"+c]){var e=d.filter(a["$eq"+c]?[a["$eq"+c]]:a["$in"+c],function(b){return this.evaluate_conditions(a,b)},this);b[(1===e.length?"$eq":"$in")+c]=1===e.length?e[0]:e}else{var f=null,g=null,h=!1,i=!1,k=j.byValue;if(a["$gt"+c]&&(f=a["$gt"+c]),a["$lt"+c]&&(f=a["$lt"+c]),a["$gte"+c]&&(null===f||k(f,a["$gte"+c])<0)&&(i=!0,f=a["$gte"+c]),a["$lte"+c]&&(null===g||k(g,a["$lte"+c])>0)&&(h=!0,g=a["$lte"+c]),a["$sw"+c]){var l=a["$sw"+c];(null===f||k(f,l)<=0)&&(i=!0,f=l);var m=null;"number"==typeof l?m=l+1:"string"==typeof l&&l.length>0&&(m=l.substring(0,l.length-1)+String.fromCharCode(l.charCodeAt(l.length-1)+1)),null!==m&&(null===g||k(g,m)>=0)&&(h=!0,g=m)}null!==g&&(b[(h?"$lte":"$lt")+c]=g),null!==f&&(b[(i?"$gte":"$gt")+c]=f),a["$ct"+c]&&(b["$ct"+c]=a["$ct"+c])}},this),b}}}),a.define("module:Queries.Engine",["module:Queries","module:Queries.Constrained","base:Strings","base:Types","base:Objs","base:Promise","base:Comparators","base:Iterators.SkipIterator","base:Iterators.LimitIterator","base:Iterators.SortedIterator","base:Iterators.FilteredIterator","base:Iterators.SortedOrIterator","base:Iterators.PartiallySortedIterator","base:Iterators.ArrayIterator","base:Iterators.LazyMultiArrayIterator"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){return{indexQueryConditionsSize:function(a,b,c){var d=c?"ic":"",e=c?"_ic":"",f=b.info(),g=f.row_count,h=f.row_count/Math.max(f["key_count"+e],1);if(a["$eq"+d])g=h;else if(a["$in"+d])g=h*a["$in"+d].length;else{var i=0,j=null;(a["$gt"+d]||a["$gte"+d])&&(j=a["$gt"+d]||a["$gte"+d],a["$gt"+d]&&i--);var k=null;(a["$lt"+d]||a["$lte"+d])&&(k=a["$lt"+d]||a["$lte"+d],a["$lt"+d]&&i--),null!==j&&null!==k?i+=b["key_count_distance"+e](j,k):null!==j?i+=b["key_count_right"+e](j):null!==k&&(i+=b["key_count_left"+e](k)),g=i*h}return g},indexQuerySize:function(a,b,c){var d=0,f=c.info();return e.iter(a.$or,function(a){if(!(b in a))return d=null,!1;var e=a[b],g=f.row_count;c.options().exact&&(g=Math.min(g,this.indexQueryConditionsSize(e,c,!1))),c.options().ignoreCase&&(g=Math.min(g,this.indexQueryConditionsSize(e,c,!0))),d+=g},this),d},queryPartially:function(a,c){var d={query:a.query,options:{}};if(a.options.sort){var f=e.ithKey(a.options.sort,0);d.options.sort={},d.options.sort[f]=a.options.sort[f]}return b.validate(d,c)},compileQuery:function(c,d,e,f){c=b.rectify(c);var l=b.sortValidate(c.options,d),m=a.validate(c.query,d.query||{}),n=b.skipValidate(c.options,d),o=b.limitValidate(c.options,d),p={skip:null,limit:null,filter:null,sort:null};m&&l&&n||(p.skip=c.options.skip,delete c.options.skip,"limit"in c.options&&o&&m&&l&&(c.options.limit+=p.skip)),m&&l&&o||(p.limit=c.options.limit,delete c.options.limit),l||(p.sort=c.options.sort,delete c.options.sort),m||(p.filter=c.query,c.query={});var q=e.call(f,c);return q.mapSuccess(function(b){return b=this._queryResultRectify(b,!1),p.filter&&(b=new k(b,function(b){return a.evaluate(p.filter,b)})),p.sort&&(b=new j(b,g.byObject(p.sort))),p.skip&&(b=new h(b,p.skip)),p.limit&&(b=new i(b,p.limit)),b},this)},compileIndexQuery:function(b,c,d){var p,q=e.exists(b.query.$or,function(a){return!(c in a)}),r=b.options.sort&&e.ithKey(b.options.sort,0)===c,s=r?b.options.sort[c]:1,t=!d.options().exact;if(q){var u=[];d["itemIterate"+(t?"_ic":"")](null,s,function(a,b){u.push(b)}),p=new n(u)}else p=new l(e.map(b.query.$or,function(a){var b=a[c];!r&&d.options().ignoreCase&&d.options().exact&&this.indexQueryConditionsSize(b,d,!0)<this.indexQueryConditionsSize(b,d,!1)&&(t=!0);var e=t?"ic":"",f=t?"_ic":"";if(b["$eq"+e]){var g=[];d["itemIterate"+f](b["$eq"+e],s,function(a,c){return a!==b["$eq"+e]?!1:void g.push(c)}),p=new n(g)}else if(b["$in"+e]){var h=0;p=new o(function(){if(h>=b["$in"+e].length)return null;var a=[];return d["itemIterate"+f](b["$in"+e][h],s,function(c,d){return c!==b["in"+e][h]?!1:void a.push(d)}),h++,a})}else{var i=null,j=null;if((b["$gt"+e]||b["$gte"+e])&&(i=b["$gt"+e]||b["$gte"+e]),(b["$lt"+e]||b["$lte"+e])&&(j=b["$lt"+e]||b["$lte"+e]),0>s){var k=i;i=j,j=k}p=new o(function(){return null!==i&&null!==j&&Math.sign(d.comparator()(i,j))===Math.sign(s)?null:(d["itemIterate"+f](i,s,function(a,b){return null===i&&(i=a),a!==i?(i=a,!1):void g.push(b)}),g)})}return p},this),d.comparator());return p=new k(p,function(c){return a.evaluate(b.query,c)}),b.options.sort&&(p=r?new m(p,g.byObject(b.options.sort),function(a,b){return a[c]===b[c]}):new j(p,g.byObject(b.options.sort))),b.options.skip&&(p=new h(p,b.options.skip)),b.options.limit&&(p=new i(p,b.options.limit)),f.value(p)},compileIndexedQuery:function(c,f,g,h,i){if(c=b.rectify(c),i=i||{},this.queryPartially(c,f)||d.is_empty(i))return this.compileQuery(c,f,g,h);if(c.options.sort){var j=e.ithKey(c.options.sort,0);if(i[j])return this.compileIndexQuery({query:a.simplifyQuery(a.disjunctiveNormalForm(c.query,!0)),options:c.options},j,i[j])}var k=a.simplifyQuery(a.disjunctiveNormalForm(c.query,!0)),l=null,m=null;return e.iter(i,function(a,b){var c=this.indexQuerySize(k,b,a);null!==c&&(null===l||l>c)&&(l=c,m=b)},this),null!==m?this.compileIndexQuery({query:k,options:c.options},m,i[m]):this.compileQuery(c,f,g,h)},_queryResultRectify:function(a,b){return a=a||[],d.is_array(a)==b?a:b?a.asArray():new n(a)}}}),a.define("module:Stores.AssocStore",["module:Stores.BaseStore","base:Promise","base:Objs"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{_read_key:function(){},_write_key:function(){},_remove_key:function(){},_iterate:function(){},constructor:function(b){b=b||{},b.create_ids=!0,a.constructor.call(this,b)},_insert:function(a){return b.tryCatch(function(){return this._write_key(a[this._id_key],a),a},this)},_remove:function(a){return b.tryCatch(function(){var b=this._read_key(a);return b&&!this._remove_key(a)?null:b},this)},_get:function(a){return b.tryCatch(function(){return this._read_key(a)},this)},_update:function(a,d){return b.tryCatch(function(){var b=this._read_key(a);return b&&(this._id_key in d&&(this._remove_key(a),a=d[this._id_key],delete d[this._id_key]),c.extend(b,d),this._write_key(a,b)),b},this)},_query:function(){return b.tryCatch(function(){return this._iterate()},this)}}})}),a.define("module:Stores.MemoryStore",["module:Stores.AssocStore","base:Iterators.ObjectValuesIterator"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b){a.constructor.call(this,b),this.__data={}},_read_key:function(a){return this.__data[a]},_write_key:function(a,b){this.__data[a]=b},_remove_key:function(a){delete this.__data[a]},_iterate:function(){return new b(this.__data)}}})}),a.define("module:Stores.BaseStore",["base:Class","base:Events.EventsMixin","module:Stores.ReadStoreMixin","module:Stores.WriteStoreMixin","base:Promise"],function(a,b,c,d,e,f){return a.extend({scoped:f},[b,c,d,function(a){return{constructor:function(b){a.constructor.call(this),this._initializeReadStore(b),this._initializeWriteStore(b)},_ensure_index:function(){},ensure_index:function(a){return this._ensure_index(a)},clear:function(){return this.query().mapSuccess(function(a){for(var b=e.and();a.hasNext();){var c=a.next();b=b.and(this.remove(c[this._id_key]))}return b},this)}}}])}),a.define("module:Stores.ReadStoreMixin",["module:Queries.Engine","module:Stores.StoreException","base:Promise","base:Objs"],function(a,b,c,d){return{_initializeReadStore:function(a){a=a||{},this._query_model="query_model"in a?a.query_model:null,this.indices={}},query_model:function(){return arguments.length>0&&(this._query_model=arguments[0]),this._query_model},_get:function(){return c.create(null,new b("unsupported: get"))},_query_capabilities:function(){return{}},_query:function(){return c.create(null,new b("unsupported: query"))},get:function(a){return this._get(a)},query:function(e,f){if(e=d.clone(e,-1),f=d.clone(f,-1),f&&(f.limit&&(f.limit=parseInt(f.limit,10)),f.skip&&(f.skip=parseInt(f.skip,10))),this._query_model){var g=this._query_model.subsumizer_of({query:e,options:f});if(!g)return this.trigger("query_miss",{query:e,options:f}),c.error(new b("Cannot execute query"));this.trigger("query_hit",{query:e,options:f},g)}return a.compileIndexedQuery({query:e,options:f||{}},this._query_capabilities(),function(a){return this._query(a.query,a.options)},this,this.indices)}}}),a.define("module:Stores.ReadStore",["base:Class","module:Stores.ReadStoreMixin"],function(a,b,c){return a.extend({scoped:c},[b,function(a){return{constructor:function(b){a.constructor.call(this),this._initializeReadStore(b)}}}])}),a.define("module:Stores.StoreException",["base:Exceptions.Exception"],function(a,b){return a.extend({scoped:b},{})}),a.define("module:Stores.StoreHistory",["base:Class","base:Objs","base:Types","module:Stores.MemoryStore"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{constructor:function(c,e,f){a.constructor.call(this),this._options=b.extend({combine_update_update:!1,combine_insert_update:!1,combine_insert_remove:!1,combine_update_remove:!1,source_id_key:c?c.id_key():"id",row_data:{},filter_data:{}},f),this.historyStore=e||new d,this.commitId=1,c&&(c.on("insert",this.sourceInsert,this),c.on("remove",this.sourceRemove,this),c.on("update",this.sourceUpdate,this))},sourceInsert:function(a){this.commitId++,this.historyStore.insert(b.extend({row:a,type:"insert",row_id:a[this._options.source_id_key],commit_id:this.commitId},this._options.row_data))},sourceUpdate:function(a,d){this.commitId++;var e=c.is_object(a)?a[this._options.source_id_key]:a,f="update";if(this._options.combine_insert_update||this._options.combine_update_update){var g=[];this._options.combine_insert_update&&g.push("insert"),this._options.combine_update_update&&g.push("update");for(var h={},i=[],j=this.historyStore.query(b.extend({type:{$or:g},row_id:e},this._options.filter_data),{sort:{commit_id:1}}).value();j.hasNext();){var k=j.next();"insert"===k.type&&(f="insert"),h=b.extend(h,k.row),i.push(this.historyStore.id_of(k))}d=b.extend(h,d),b.iter(i,this.historyStore.remove,this.historyStore)}this.historyStore.insert(b.extend({row:d,type:f,row_id:e,commit_id:this.commitId},this._options.row_data))},sourceRemove:function(a){if(this.commitId++,this._options.combine_insert_remove&&this.historyStore.query(b.extend({type:"insert",row_id:a},this._options.filter_data)).value().hasNext())for(var c=this.historyStore.query(b.extend({row_id:a},this._options.filter_data)).value();c.hasNext();)this.historyStore.remove(this.historyStore.id_of(c.next()));else{if(this._options.combine_update_remove)for(var d=this.historyStore.query(b.extend({type:"update",row_id:a},this._options.filter_data)).value();d.hasNext();)this.historyStore.remove(this.historyStore.id_of(d.next()));this.historyStore.insert(b.extend({type:"remove",row_id:a,commit_id:this.commitId},this._options.row_data))}}}})}),a.define("module:Stores.WriteStoreMixin",["module:Stores.StoreException","base:Promise","base:Classes.TimedIdGenerator","base:Types"],function(a,b,c,d){return{_initializeWriteStore:function(a){a=a||{},this._id_key=a.id_key||"id",this._create_ids=a.create_ids||!1,this._create_ids&&(this._id_generator=a.id_generator||this._auto_destroy(new c)),this._query_model="query_model"in a?a.query_model:null},query_model:function(){return arguments.length>0&&(this._query_model=arguments[0]),this._query_model},id_key:function(){return this._id_key},id_of:function(a){return a[this.id_key()]},_inserted:function(a,b){this.trigger("insert",a,b),this.trigger("write","insert",a,b)},_removed:function(a,b){this.trigger("remove",a,b),this.trigger("write","remove",a,b)},_updated:function(a,b,c){this.trigger("update",a,b,c),this.trigger("write","update",a,b,c)},insert_all:function(a,c){var d=null;arguments.length>2&&(d=arguments[2]),c&&this._query_model&&(this.trigger("query_register",c),this._query_model.register(c));for(var e=b.and(),f=0;f<a.length;++f)e=e.and(this.insert(d?[a[f],d]:a[f]));return e.end()},_insert:function(){return b.create(null,new a("unsupported: insert"))},_remove:function(){return b.create(null,new a("unsupported: remove"))},_update:function(){return b.create(null,new a("unsupported: update"))},insert:function(a){var b=null;return d.is_array(a)&&(b=a[1],a=a[0]),!this._create_ids||this._id_key in a&&a[this._id_key]||(a[this._id_key]=this._id_generator.generate()),this._insert(a).success(function(a){this._inserted(a,b)},this)},remove:function(a){var b=null;return d.is_array(a)&&(b=a[1],a=a[0]),this._remove(a).success(function(){this._removed(a,b)},this)},update:function(a,b){var c=null;return d.is_array(b)&&(c=b[1],b=b[0]),this._update(a,b).success(function(a){this._updated(a,b,c)},this)}}}),a.define("module:Stores.WriteStore",["base:Class","base:Events.EventsMixin","module:Stores.WriteStoreMixin"],function(a,b,c,d){return a.extend({scoped:d},[b,c,function(a){return{constructor:function(b){a.constructor.call(this),this._initializeWriteStore(b)},_ensure_index:function(){},ensure_index:function(a){return this._ensure_index(a)}}}])}),a.define("module:Stores.ConversionStore",["module:Stores.BaseStore","base:Objs","base:Iterators.MappedIterator"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b,c){c=c||{},c.id_key=b._id_key,a.constructor.call(this,c),this.__store=b,this.__key_encoding=c.key_encoding||{},this.__key_decoding=c.key_decoding||{},this.__value_encoding=c.value_encoding||{},this.__value_decoding=c.value_decoding||{},this.__projection=c.projection||{}},store:function(){return this.__store},encode_object:function(a){if(!a)return null;var c={};for(var d in a){var e=this.encode_key(d);e&&(c[e]=this.encode_value(d,a[d]))}return b.extend(c,this.__projection)},decode_object:function(a){if(!a)return null;var b={};for(var c in a){var d=this.decode_key(c);d&&(b[d]=this.decode_value(c,a[c]))}for(c in this.__projection)delete b[c];return b},encode_key:function(a){return a in this.__key_encoding?this.__key_encoding[a]:a},decode_key:function(a){return a in this.__key_decoding?this.__key_decoding[a]:a},encode_value:function(a,b){return a in this.__value_encoding?this.__value_encoding[a](b):b},decode_value:function(a,b){return a in this.__value_decoding?this.__value_decoding[a](b):b},_query_capabilities:function(){return this.__store._query_capabilities()},_ensure_index:function(a){return this.__store.ensure_index(a)},_insert:function(a){return this.__store.insert(this.encode_object(a)).mapSuccess(this.decode_object,this)},_remove:function(a){return this.__store.remove(this.encode_value(this._id_key,a))},_get:function(a){return this.__store.get(this.encode_value(this._id_key,a)).mapSuccess(this.decode_object,this)},_update:function(a,b){return this.__store.update(this.encode_value(this._id_key,a),this.encode_object(b)).mapSuccess(this.decode_object,this)},_query:function(a,b){return this.__store.query(this.encode_object(a),b).mapSuccess(function(a){return new c(a,this.decode_object,this)},this)}}})}),a.define("module:Stores.PassthroughStore",["module:Stores.BaseStore","base:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b,c){this.__store=b,c=c||{},c.id_key=b.id_key(),this._projection=c.projection||{},a.constructor.call(this,c),c.destroy_store&&this._auto_destroy(b)},_query_capabilities:function(){return this.__store._query_capabilities()},_insert:function(a){return this.__store.insert(b.extend(a,this._projection))},_remove:function(a){return this.__store.remove(a)},_get:function(a){return this.__store.get(a)},_update:function(a,b){return this.__store.update(a,b)},_query:function(a,c){return this.__store.query(b.extend(a,this._projection),c)},_ensure_index:function(a){return this.__store.ensure_index(a)},_store:function(){return this.__store}}})}),a.define("module:Stores.WriteDelegatorStore",["module:Stores.BaseStore"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this,c),this.writeStore=b},destroy:function(){this.writeStore.off(null,null,this),a.destroy.call(this)},_insert:function(a){return this.writeStore.insert(a)},_remove:function(a){return this.writeStore.remove(a)},_update:function(a,b){return this.writeStore.update(a,b)},_ensure_index:function(a){return this.writeStore.ensure_index(a)}}})}),a.define("module:Stores.ReadDelegatorStore",["module:Stores.BaseStore"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this,c),this.readStore=b},_query_capabilities:function(){return this.readStore._query_capabilities()},_get:function(a){return this.readStore.get(a)},_query:function(a,b){return this.readStore.query(Objs.extend(a,this._projection),b)}}})}),a.define("module:Stores.AssocDumbStore",["module:Stores.DumbStore"],function(a,b){return a.extend({scoped:b},{_read_key:function(){},_write_key:function(){},_remove_key:function(){},__read_id:function(a){var b=this._read_key(a);return b?parseInt(b,10):null},_read_last_id:function(){return this.__read_id("last_id")},_write_last_id:function(a){this._write_key("last_id",a)},_remove_last_id:function(){this._remove_key("last_id")},_read_first_id:function(){return this.__read_id("first_id")},_write_first_id:function(a){this._write_key("first_id",a)},_remove_first_id:function(){this._remove_key("first_id")},_read_item:function(a){return this._read_key("item_"+a)},_write_item:function(a,b){this._write_key("item_"+a,b)},_remove_item:function(a){this._remove_key("item_"+a)},_read_next_id:function(a){return this.__read_id("next_"+a)},_write_next_id:function(a,b){this._write_key("next_"+a,b)},_remove_next_id:function(a){this._remove_key("next_"+a)},_read_prev_id:function(a){return this.__read_id("prev_"+a)},_write_prev_id:function(a,b){this._write_key("prev_"+a,b)},_remove_prev_id:function(a){this._remove_key("prev_"+a)}})}),a.define("module:Stores.DumbStore",["module:Stores.BaseStore","base:Promise","base:Objs","base:Iterators.Iterator"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{_read_last_id:function(){},_write_last_id:function(){},_remove_last_id:function(){},_read_first_id:function(){},_write_first_id:function(){},_remove_first_id:function(){},_read_item:function(){},_write_item:function(){},_remove_item:function(){},_read_next_id:function(){},_write_next_id:function(){},_remove_next_id:function(){},_read_prev_id:function(){},_write_prev_id:function(){},_remove_prev_id:function(){},constructor:function(b){b=b||{},b.create_ids=!0,a.constructor.call(this,b)},_insert:function(a){return b.tryCatch(function(){var b=this._read_last_id(),c=a[this._id_key];return null!==b?(this._write_next_id(b,c),this._write_prev_id(c,b)):this._write_first_id(c),this._write_last_id(c),this._write_item(c,a),a},this)},_remove:function(a){return b.tryCatch(function(){var b=this._read_item(a);if(b){this._remove_item(a);var c=this._read_next_id(a),d=this._read_prev_id(a);null!==c?(this._remove_next_id(a),null!==d?(this._remove_prev_id(a),this._write_next_id(d,c),this._write_prev_id(c,d)):(this._remove_prev_id(c),this._write_first_id(c))):null!==d?(this._remove_next_id(d),this._write_last_id(d)):(this._remove_first_id(),this._remove_last_id())}return b},this)},_get:function(a){return b.tryCatch(function(){return this._read_item(a)},this)},_update:function(a,d){return b.tryCatch(function(){var b=this._get(a);return b&&(delete d[this._id_key],c.extend(b,d),this._write_item(a,b)),b},this)},_query:function(a){return b.tryCatch(function(){var b=new d,e=this,f=this._read_first_id();return c.extend(b,{__id:null===f?1:f,__store:e,__query:a,hasNext:function(){var a=this.__store._read_last_id();if(null===a)return!1;for(;this.__id<a&&!this.__store._read_item(this.__id);)this.__id++;return this.__id<=a},next:function(){if(this.hasNext()){var a=this.__store.get(this.__id);return this.__id==this.__store._read_last_id()?this.__id++:this.__id=this.__store._read_next_id(this.__id),a}return null}}),b},this)}}})}),a.define("module:Stores.LocalStore",["module:Stores.AssocDumbStore","json:"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b,c){a.constructor.call(this,b),this.__prefix=b.prefix,this.__localStorage=c},__key:function(a){return this.__prefix+a},_read_key:function(a){var c=this.__key(a);return c in this.__localStorage?b.parse(this.__localStorage[c]):null},_write_key:function(a,c){this.__localStorage[this.__key(a)]=b.stringify(c)},_remove_key:function(a){delete this.__localStorage[this.__key(a)]}}})}),a.define("module:Stores.RemoteStoreException",["module:Stores.StoreException","base:Net.AjaxException"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c){c=b.ensure(c),a.constructor.call(this,c.toString()),this.__source=c},source:function(){return this.__source}}})}),a.define("module:Stores.RemoteStore",["module:Stores.BaseStore","module:Stores.RemoteStoreException","base:Objs","base:Types","json:"],function(a,b,c,d,e,f){return a.extend({scoped:f},function(a){return{constructor:function(b,d,e){a.constructor.call(this,e),this._uri=b,this.__ajax=d,this.__options=c.extend({update_method:"PUT",uri_mappings:{}},e||{})},getUri:function(){return this._uri},prepare_uri:function(a,b){return this.__options.uri_mappings[a]?this.__options.uri_mappings[a](b):"remove"==a||"get"==a||"update"==a?this.getUri()+"/"+b[this._id_key]:this.getUri()},_encode_query:function(){return{uri:this.prepare_uri("query")}},__invoke:function(a,c){return this.__ajax.asyncCall(a).mapCallback(function(a,f){if(a)return new b(a);if(c&&d.is_string(f))try{f=e.parse(f)}catch(g){}return f})},_insert:function(a){return this.__invoke({method:"POST",uri:this.prepare_uri("insert",a),data:a},!0)},_get:function(a){var b={};return b[this._id_key]=a,this.__invoke({uri:this.prepare_uri("get",b)})},_update:function(a,b){var d=c.clone(b,1);return d[this._id_key]=a,this.__invoke({method:this.__options.update_method,uri:this.prepare_uri("update",d),data:b})},_remove:function(a){var b={};return b[this._id_key]=a,this.__invoke({method:"DELETE",uri:this.prepare_uri("remove",b)})},_query:function(a,b){return this.__invoke(this._encode_query(a,b),!0)}}})}),a.define("module:Stores.QueryGetParamsRemoteStore",["module:Queries","module:Stores.RemoteStore","json:"],function(a,b,c,d){return b.extend({scoped:d},function(b){return{constructor:function(a,c,d,e){b.constructor.call(this,a,c,e),this.__capability_params=d},_query_capabilities:function(){var b={};return"skip"in this.__capability_params&&(b.skip=!0),"limit"in this.__capability_params&&(b.limit=!0),"query"in this.__capability_params&&(b.query=a.fullQueryCapabilities()),"sort"in this.__capability_params&&(b.sort=!0),b},_encode_query:function(a,b){b=b||{};var d=this.getUri()+"?";return b.skip&&"skip"in this.__capability_params&&(d+=this.__capability_params.skip+"="+b.skip+"&"),b.limit&&"limit"in this.__capability_params&&(d+=this.__capability_params.limit+"="+b.limit+"&"),b.sort&&"sort"in this.__capability_params&&(d+=this.__capability_params.sort+"="+c.stringify(b.sort)+"&"),"query"in this.__capability_params&&(d+=this.__capability_params.query+"="+c.stringify(a)+"&"),{uri:d}}}})}),a.define("module:Stores.SocketStore",["module:Stores.BaseStore","base:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b,c,d){a.constructor.call(this,b),this.__socket=c,this.__prefix=d,this._supportsAsync=!1},__send:function(a,b){this.__socket.emit(this.__prefix+":"+a,b)},_insert:function(a){this.__send("insert",a)},_remove:function(a){this.__send("remove",a)},_update:function(a,c){this.__send("update",b.objectBy(a,c))}}})}),a.define("module:Stores.AbstractIndex",["base:Class","base:Comparators","base:Objs","base:Functions"],function(a,b,c,d,e){return a.extend({scoped:e},function(a){return{constructor:function(d,e,f,g){a.constructor.call(this),this._options=c.extend({exact:!0,ignoreCase:!1},g),this._compare=f||b.byValue,this._store=d,this.__row_count=0,this._initialize();var h=d.id_key();d.query({}).value().iterate(function(a){this.__row_count++,this._insert(a[h],a[e])},this),d.on("insert",function(a){
this.__row_count++,this._insert(a[h],a[e])},this),d.on("remove",function(a){this.__row_count--,this._remove(a)},this),d.on("update",function(a,b){e in b&&this._update(a,b[e])},this)},_initialize:function(){},destroy:function(){this._store.off(null,null,this),a.destroy.call(this)},compare:function(){return this._compare.apply(arguments)},comparator:function(){return d.as_method(this,this._compare)},info:function(){return{row_count:this.__row_count,key_count:this._key_count(),key_count_ic:this._key_count_ic()}},options:function(){return this._options},iterate:function(a,b,c,d){this._iterate(a,b,c,d)},itemIterate:function(a,b,c,d){this.iterate(a,b,function(a,b){return c.call(d,a,this._store.get(b).value())},this)},iterate_ic:function(a,b,c,d){this._iterate_ic(a,b,c,d)},itemIterateIc:function(a,b,c,d){this.iterate_ic(a,b,function(a,b){return c.call(d,a,this._store.get(b).value())},this)},_iterate:function(){},_iterate_ic:function(){},_insert:function(){},_remove:function(){},_update:function(){},_key_count:function(){},_key_count_ic:function(){},key_count_left_ic:function(){},key_count_right_ic:function(){},key_count_distance_ic:function(){},key_count_left:function(){},key_count_right:function(){},key_count_distance:function(){}}})}),a.define("module:Stores.MemoryIndex",["module:Stores.AbstractIndex","base:Structures.TreeMap","base:Objs"],function(a,b,c,d){return a.extend({scoped:d},function(){return{_initialize:function(){this._options.exact&&(this._exactMap=b.empty(this._compare)),this._options.ignoreCase&&(this._ignoreCaseMap=b.empty(this._compare)),this._idToKey={}},__insert:function(a,d,e){var f=b.find(d,e);return f?f[a]=!0:e=b.add(d,c.objectBy(a,!0),e),e},_insert:function(a,b){this._idToKey[a]=b,this._options.exact&&(this._exactMap=this.__insert(a,b,this._exactMap)),this._options.ignoreCase&&(this._ignoreCaseMap=this.__insert(a,b,this._ignoreCaseMap))},__remove:function(a,d,e){var f=b.find(a,d);return delete f[e],c.is_empty(f)&&(d=b.remove(a,d)),d},_remove:function(a){var b=this._idToKey[a];delete this._idToKey[a],this._options.exact&&(this._exactMap=this.__remove(b,this._exactMap,a)),this._options.ignoreCase&&(this._ignoreCaseMap=this.__remove(b,this._ignoreCaseMap,a))},_update:function(a,b){var c=this._idToKey[a];c!=b&&(this._remove(a),this._insert(a,b))},_iterate:function(a,c,d,e){b.iterate_from(a,this._exactMap,function(a,b){for(var c in b)if(d.call(e,a,c)===!1)return!1;return!0},this,!c)},_iterate_ic:function(a,c,d,e){b.iterate_from(a,this._ignoreCaseMap,function(a,b){for(var c in b)if(d.call(e,a,c)===!1)return!1;return!0},this,!c)},_key_count:function(){return this._options.exact?b.length(this._exactMap):0},_key_count_ic:function(){return this._options.ignoreCase?b.length(this._ignoreCaseMap):0},key_count_left_ic:function(a){return b.treeSizeLeft(a,this._ignoreCaseMap)},key_count_right_ic:function(a){return b.treeSizeRight(a,this._ignoreCaseMap)},key_count_distance_ic:function(a,c){return b.distance(a,c,this._ignoreCaseMap)},key_count_left:function(a){return b.treeSizeLeft(a,this._exactMap)},key_count_right:function(a){return b.treeSizeRight(a,this._exactMap)},key_count_distance:function(a,c){return b.distance(a,c,this._exactMap)}}})}),a.define("module:Stores.CachedStore",["module:Stores.DualStore","module:Stores.MemoryStore","module:Queries.DefaultQueryModel","module:Queries.Constrained","base:Objs","base:Async"],function(a,b,c,d,e,f,g){return a.extend({scoped:g},function(a){return{constructor:function(g,h){h=h||{};var i=h.cache_store;"cache_store"in h||(i=this._auto_destroy(new b({id_key:g.id_key()}))),i.query_model()||i.query_model(h.cache_query_model?h.cache_query_model:this._auto_destroy(new c)),this.__invalidation_options=h.invalidation||{},a.constructor.call(this,g,i,e.extend({get_options:{start:"second",strategy:"or"},query_options:{start:"second",strategy:"or",clone:!0,or_on_null:!1}},h)),this.__invalidation_options.reload_after_first_hit&&(this.__queries={},this.cache().on("query_hit",function(a,b){var c=d.serialize(b);this.__queries[c]||(this.__queries[c]=!0,f.eventually(function(){this.invalidate_query(b,!0)},[],this))},this),this.cache().on("query_miss",function(a){var b=d.serialize(a);this.__queries[b]=!0},this))},destroy:function(){this.cache().off(null,null,this),a.destroy.call(this)},invalidate_query:function(a,b){this.cache().query_model().invalidate(a),b&&this.query(a.query,a.options),this.trigger("invalidate_query",a,b)},cache:function(){return this.second()},store:function(){return this.first()}}})}),a.define("module:Stores.DualStore",["module:Queries","module:Queries.Constrained","module:Stores.BaseStore","base:Objs","base:Iterators.ArrayIterator"],function(a,b,c,d,e,f){return c.extend({scoped:f},function(c){return{constructor:function(a,b,e){e=d.extend({create_options:{},update_options:{},delete_options:{},get_options:{},query_options:{}},e||{}),e.id_key=a._id_key,this.__first=a,this.__second=b,c.constructor.call(this,e),this.__create_options=d.extend({start:"first",strategy:"then",auto_replicate:"first"},e.create_options),this.__update_options=d.extend({start:"first",strategy:"then",auto_replicate:"first"},e.update_options),this.__remove_options=d.extend({start:"first",strategy:"then",auto_replicate:"first"},e.delete_options),this.__get_options=d.extend({start:"first",strategy:"or",clone:!0,clone_second:!1,or_on_null:!0},e.get_options),this.__query_options=d.extend({start:"first",strategy:"or",clone:!0,clone_second:!1,or_on_null:!0},e.query_options),this.__first.on("insert",this.__inserted_first,this),this.__second.on("insert",this.__inserted_second,this),this.__first.on("update",this.__updated_first,this),this.__second.on("update",this.__updated_second,this),this.__first.on("remove",this.__removed_first,this),this.__second.on("remove",this.__removed_second,this)},__inserted_first:function(a,b){b&&b.dual_insert||(("first"==this.__create_options.auto_replicate||"both"==this.__create_options.auto_replicate)&&this.__second.insert([a,{dual_insert:!0}]),this._inserted(a))},__inserted_second:function(a,b){b&&b.dual_insert||(("second"==this.__create_options.auto_replicate||"both"==this.__create_options.auto_replicate)&&this.__first.insert([a,{dual_insert:!0}]),this._inserted(a))},__updated_first:function(a,b,c){c&&c.dual_update||(("first"==this.__update_options.auto_replicate||"both"==this.__update_options.auto_replicate)&&this.__second.update(a[this.id_key()],[b,{dual_update:!0}]),this._updated(a,b))},__updated_second:function(a,b,c){c&&c.dual_update||(("second"==this.__update_options.auto_replicate||"both"==this.__update_options.auto_replicate)&&this.__first.update(a[this.id_key()],[b,{dual_update:!0}]),this._updated(a,b))},__removed_first:function(a,b){b&&b.dual_remove||(("first"==this.__remove_options.auto_replicate||"both"==this.__remove_options.auto_replicate)&&this.__second.remove([a,{dual_remove:!0}]),this._removed(a))},__removed_second:function(a,b){b&&b.dual_remove||(("second"==this.__remove_options.auto_replicate||"both"==this.__remove_options.auto_replicate)&&this.__first.remove([a,{dual_remove:!0}]),this._removed(a))},first:function(){return this.__first},second:function(){return this.__second},_insert:function(a){var b=this.__first,c=this.__second;"first"!=this.__create_options.start&&(b=this.__second,c=this.__first);var d=this.__create_options.strategy;return"then"==d?b.insert([a,{dual_insert:!0}]).mapSuccess(function(a){return c.insert([a,{dual_insert:!0}])},this):"or"==d?b.insert([a,{dual_insert:!0}]).mapError(function(){return c.insert([a,{dual_insert:!0}])},this):b.insert([a,{dual_insert:!0}])},_update:function(a,b){var c=this.__first,d=this.__second;"first"!=this.__update_options.start&&(c=this.__second,d=this.__first);var e=this.__update_options.strategy;return"then"==e?c.update(a,[b,{dual_update:!0}]).mapSuccess(function(b){return d.update(a,[b,{dual_update:!0}])},this):"or"==e?c.update(a,[b,{dual_update:!0}]).mapError(function(){return d.update(a,[b,{dual_update:!0}])},this):c.update(a,[b,{dual_update:!0}])},_remove:function(a){var b=this.__first,c=this.__second;"first"!=this.__remove_options.start&&(b=this.__second,c=this.__first);var d=this.__remove_options.strategy;return"then"==d?b.remove([a,{dual_remove:!0}]).mapSuccess(function(){return c.remove([a,{dual_remove:!0}])},this):"or"==d?b.remove([a,{dual_remove:!0}]).mapError(function(){return c.remove([a,{dual_remove:!0}])},this):b.remove(a)},_query_capabilities:function(){return b.fullConstrainedQueryCapabilities(a.fullQueryCapabilities())},_get:function(a){var b=this.__first,c=this.__second;"first"!=this.__get_options.start&&(b=this.__second,c=this.__first);var d=this.__get_options.strategy,e=this.__get_options.clone,f=this.__get_options.clone_second,g=this.__get_options.or_on_null;return"or"==d?b.get(a).mapCallback(function(d,h){return d||!h&&g?c.get(a).mapSuccess(function(a){return a&&e?b.insert(a):a},this):f?c.get(a).mapCallback(function(a,b){return a||!b?c.insert(h):h},this):h},this):b.get(a)},_query:function(a,b){var c=this.__first,d=this.__second;"first"!=this.__query_options.start&&(c=this.__second,d=this.__first);var f=this.__query_options.strategy,g=this.__query_options.clone,h=this.__get_options.clone_second,i=this.__query_options.or_on_null;return"or"==f?(this.trigger("query_first",a,b),c.query(a,b).mapCallback(function(f,j){return f||!j&&i?(this.trigger("query_second",a,b),d.query(a,b).mapSuccess(function(d){if(d&&g){var f=d.asArray();return c.insert_all(f,{query:a,options:b},{dual_insert:!0}).mapSuccess(function(){return new e(f)})}return d},this)):h?(this.trigger("query_second",a,b),d.query(a,b).mapCallback(function(c,f){if(c||!f){var g=j.asArray();return d.insert_all(g,{query:a,options:b},{dual_insert:!0}).mapSuccess(function(){return new e(g)})}return j},this)):j},this)):(this.trigger("query_first",a,b),c.query(a,b))}}})}),a.define("module:Queries.AbstractQueryModel",["base:Class"],function(a,b){return a.extend({scoped:b},{register:function(){},executable:function(){}})}),a.define("module:Queries.DefaultQueryModel",["module:Queries.AbstractQueryModel","module:Queries.Constrained","base:Objs"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(){a.constructor.call(this),this.__queries={}},_insert:function(a){this.__queries[b.serialize(a)]=a},_remove:function(a){delete this.__queries[b.serialize(a)]},exists:function(a){return b.serialize(a)in this.__queries},subsumizer_of:function(a){if(this.exists(a))return a;var d=null;return c.iter(this.__queries,function(c){return b.subsumizes(c,a)&&(d=c),!d},this),d},executable:function(a){return!!this.subsumizer_of(a)},register:function(a){for(var d=!0,e=function(c){b.subsumizes(a,c)&&(this._remove(c),d=!0)};d;)d=!1,c.iter(this.__queries,e,this);this._insert(a)},invalidate:function(a){var b=this.subsumizer_of(a);b&&this._remove(b)}}})}),a.define("module:Queries.StoreQueryModel",["module:Queries.DefaultQueryModel","module:Queries.Constrained"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b){this.__store=b,a.constructor.call(this)},initialize:function(){return this.__store.mapSuccess(function(a){for(;a.hasNext();){var b=a.next();delete b.id,this._insert(b)}},this)},_insert:function(b){a._insert.call(this,b),this.__store.insert(b)},_remove:function(a){delete this.__queries[b.serialize(a)],this.__store.query({query:a}).success(function(a){for(;a.hasNext();)this.__store.remove(a.next().id)},this)}}})}),a.define("module:Collections.QueryCollection",["base:Collections.Collection","base:Objs","base:Types","base:Comparators","base:Promise","base:Class","module:Queries.Constrained","module:Queries"],function(a,b,c,d,e,f,g,h,i){return a.extend({scoped:i},function(a){return{constructor:function(b,c,d){a.constructor.call(this),d=d||{},this._id_key=this._id_key||d.id_key||"id",this._source=b,this._complete=!1,this._active=d.active||!1,this._incremental="incremental"in d?d.incremental:!0,this._active_bounds="active_bounds"in d?d.active_bounds:!0,this._enabled=!1,this._range=d.range||null,this._forward_steps=d.forward_steps||null,this._backward_steps=d.backward_steps||null,this._query={query:{},options:{skip:0,limit:null,sort:null}},this._watched=null,c=c||{},this.update(c.query?c:{query:c,options:{skip:d.skip||0,limit:d.limit||d.range||null,sort:d.sort||null}}),d.auto&&this.enable()},destroy:function(){this.disable(),a.destroy.call(this)},paginate:function(a){return this.update({options:{skip:a*this._range,limit:this._range}})},paginate_index:function(){return Math.floor(this.getSkip()/this._range)},paginate_next:function(){return this.isComplete()?e.create(!0):this.paginate(this.paginate_index()+1)},paginate_prev:function(){return this.paginate_index()>0?this.paginate(this.paginate_index()-1):e.create(!0)},increase_forwards:function(a){return a=a||this._forward_steps,this.isComplete()?e.create(!0):this.update({options:{limit:this.getLimit()+a}})},increase_backwards:function(a){return a=a||this._backward_steps,this.getSkip()?this.update({options:{skip:Math.max(this.getSkip()-a,0),limit:this.getLimit()?this.getLimit()+this.getSkip()-Math.max(this.getSkip()-a,0):null}}):e.create(!0)},get_ident:function(a){return f.is_class_instance(a)?a.get(this._id_key):a[this._id_key]},getQuery:function(){return this._query},getSkip:function(){return this._query.options.skip||0},getLimit:function(){return this._query.options.limit||null},update:function(a){a=g.rectify(a);var c=this._query.options.skip||0,d=this._query.options.limit||null;if(a.query&&(this._query.query=a.query),this._query.options=b.extend(this._query.options,a.options),!this._enabled)return e.create(!0);if(a.query||"sort"in a.options||!this._incremental)return this.refresh();var f="skip"in a.options?a.options.skip||0:c,h="limit"in a.options?a.options.limit||null:d;if(f===c&&h===d)return e.create(!0);if(h&&c>=f+h||d&&f>=c+d)return this.refresh();for(;f>c&&(null===d||d>0);)this.remove(this.getByIndex(0)),c++,d--;var i=e.create(!0);if(c>f){var j=c-f;null!==h&&(j=Math.min(j,h)),i=this._execute(b.tree_extend({options:{skip:f,limit:j}},this._query,2)),f+=j,null!==h&&(h-=j)}if(!d||h&&d>=h){if(h)for(;this.count()>h;)this.remove(this.getByIndex(this.count()-1));return i}return i.and(this._execute(b.tree_extend({options:{skip:c+d,limit:h?h-d:null}},this._query,2)))},enable:function(){this._enabled||(this._enabled=!0,this.refresh())},disable:function(){this._enabled&&(this._enabled=!1,this.clear(),this._watched&&(this._unwatchQuery(this._watched),this._watched=null))},refresh:function(a){return a&&this.clear(),this.set_compare(this._query.options.sort&&!c.is_empty(this._query.options.sort)?d.byObject(this._query.options.sort):null),this._watched&&(this._unwatchQuery(this._watched),this._watched=null),this._active&&(this._watched=this._query.query,this._watchQuery(this._watched)),this._execute(this._query)},isEnabled:function(){return this._enabled},_execute:function(a){var b=a.options.limit;return this._subExecute(a.query,a.options).mapSuccess(function(a){var c=a.asArray();return this._complete=null===b||c.length<b,this.replace_objects(c),!0},this)},_subExecute:function(a,b){return this._source.query(a,b)},isComplete:function(){return this._complete},_watchQuery:function(){},_unwatchQuery:function(){},isValid:function(a){return h.evaluate(this._query.query,a)},_materialize:function(a){return a},_activeCreate:function(a){this._active&&this._enabled&&this.isValid(a)&&(this.add(this._materialize(a)),this._query.options.limit&&this.count()>this._query.options.limit&&(this._active_bounds?this._query.options.limit++:this.remove(this.getByIndex(this.count()-1))))},_activeRemove:function(a){if(this._active&&this._enabled){var b=this.getById(a);b&&(this.remove(b),null!==this._query.options.limit&&this._active_bounds&&this._query.options.limit--)}},_activeUpdate:function(a,c,d){if(this._active&&this._enabled){var e=this.getById(a),f=b.extend(d,c);e?this.isValid(f)?e.setAll(c):this._activeRemove(a):this._activeCreate(f)}}}})}),a.define("module:Collections.StoreQueryCollection",["module:Collections.QueryCollection","base:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d,e){a.constructor.call(this,c,d,b.extend({id_key:c.id_key()},e)),c.on("insert",this._activeCreate,this),c.on("remove",this._activeRemove,this),c.on("update",function(a,b){this._activeUpdate(c.id_of(a),b,a)},this)},destroy:function(){this._source.off(null,null,this),a.destroy.call(this)},get_ident:function(a){return a.get(this._source.id_key())}}})}),a.define("module:Collections.TableQueryCollection",["module:Collections.QueryCollection","base:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d,e){a.constructor.call(this,c,d,b.extend({id_key:c.primary_key()},e)),c.on("create",this._activeCreate,this),c.on("remove",this._activeRemove,this),c.on("update",this._activeUpdate,this)},destroy:function(){this._source.off(null,null,this),a.destroy.call(this)},_materialize:function(a){return this._source.materialize(a)}}})}),a.define("module:Modelling.ModelException",["base:Exceptions.Exception"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this,c),this.__model=b},model:function(){return this.__model}}})}),a.define("module:Modelling.ModelMissingIdException",["module:Modelling.ModelException"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this,b,"No id given.")}}})}),a.define("module:Modelling.ModelInvalidException",["module:Modelling.ModelException","base:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c){var d=b.values(c.errors()).join("\n");a.constructor.call(this,c,d)}}})}),a.define("module:Modelling.Model",["module:Modelling.AssociatedProperties","module:Modelling.ModelInvalidException","base:Objs","base:Promise","base:Types","base:Exceptions"],function(a,b,c,d,e,f,g){return a.extend({scoped:g},function(a){return{constructor:function(b,d,e){this.__table=d,this.__options=c.extend({newModel:!0,removed:!1},e),this.__silent=1,a.constructor.call(this,b),this.__silent=0,this.isNew()||(this._properties_changed={},this._registerEvents()),this.option("auto_create")&&this.isNew()&&this.save()},destroy:function(){this.__table.off(null,null,this),this.trigger("destroy"),a.destroy.call(this)},option:function(a){var b=a in this.__options?this.__options:this.table().options();return b[a]},table:function(){return this.__table},isSaved:function(){return this.isRemoved()||!this.isNew()&&!this.isChanged()},isNew:function(){return this.option("newModel")},isRemoved:function(){return this.option("removed")},_registerEvents:function(){this.__table.on("update:"+this.id(),function(a){if(!this.isRemoved()){this.__silent++;for(var b in a)this._properties_changed[b]||this.set(b,a);this.__silent--}},this),this.__table.on("remove:"+this.id(),function(){this.isRemoved()||(this.trigger("remove"),this.__options.removed=!0)},this)},update:function(a){return this.__silent++,this.setAll(a),this.__silent--,this.isNew()?d.create(!0):this.save()},_afterSet:function(b,c,d,e){a._afterSet.call(this,b,c,d,e);var f=this.cls.scheme();b in f&&!(this.__silent>0)&&this.option("auto_update")&&!this.isNew()&&this.save()},save:function(){if(this.isRemoved())return d.create({});var a=this.option("save_invalid")?d.value(!0):this.validate();return a.mapSuccess(function(a){if(!a)return d.create(null,new b(this));var c;if(this.isNew())c=this.cls.filterPersistent(this.get_all_properties()),this.__options.type_column&&(c[this.__options.type_column]=this.cls.classname);else if(c=this.cls.filterPersistent(this.properties_changed()),e.is_empty(c))return d.create(c);var g=this.isNew(),h=this.isNew()?this.__table.store().insert(c):this.__table.store().update(this.id(),c);return h.mapCallback(function(a,b){return a?f.ensure(this.validation_exception_conversion(a)):(this.__silent++,this.setAll(b),this.__silent--,this._properties_changed={},this.trigger("save"),g&&(this.__options.newModel=!1,this._registerEvents()),b)},this)},this)},remove:function(){return this.isNew()||this.isRemoved()?d.create(!0):this.__table.store().remove(this.id()).mapSuccess(function(a){return this.trigger("remove"),this.__options.removed=!0,a},this)}}})}),a.define("module:Modelling.SchemedProperties",["base:Properties.Properties","base:Types","base:Promise","base:Objs","module:Stores.RemoteStoreException","base:Net.HttpHeader","module:Modelling.ModelInvalidException"],function(a,b,c,d,e,f,g,h){return a.extend({scoped:h},function(a){return{constructor:function(c){a.constructor.call(this);var d=this.cls.scheme();this._properties_changed={},this.__errors={};for(var e in d)"def"in d[e]?this.set(e,b.is_function(d[e].def)?d[e].def():d[e].def):d[e].auto_create?this.set(e,d[e].auto_create(this)):this.set(e,null);this._properties_changed={},this.__errors={};for(e in c)this.set(e,c[e])},_unsetChanged:function(a){delete this._properties_changed[a]},_beforeSet:function(a,c){var d=this.cls.scheme();if(!(a in d))return c;var e=d[a];return e.type&&(c=b.parseType(c,e.type)),e.transform&&(c=e.transform.apply(this,[c])),c},_afterSet:function(a,c){var d=this.cls.scheme();if(a in d&&(this._properties_changed[a]=c,delete this.__errors[a],d[a].after_set)){var e=b.is_string(d[a].after_set)?this[d[a].after_set]:d[a].after_set;e.apply(this,[c])}},isChanged:function(){return!b.is_empty(this._properties_changed)},properties_changed:function(){return this._properties_changed},get_all_properties:function(){var a={},b=this.cls.scheme();for(var c in b)a[c]=this.get(c);return a},validate:function(){this.trigger("validate");var a=[];for(var b in this.cls.scheme())a.push(this._validateAttr(b));return a.push(c.box(this._customValidate,this)),c.and(a).end().mapSuccess(function(a){var b=!0;return d.iter(a,function(a){b=b&&a}),b})},_customValidate:function(){return!0},_validateAttr:function(a){delete this.__errors[a];var e=this.cls.scheme(),f=e[a],g=f.validate;if(!g)return c.value(!0);b.is_array(g)||(g=[g]);var h=this.get(a),i=[];return d.iter(g,function(a){i.push(c.box(a.validate,a,[h,this]))},this),c.and(i).end().mapSuccess(function(b){var c=!0;return d.iter(b,function(b){null!==b&&(c=!1,this.__errors[a]=b)},this),this.trigger("validate:"+a,c,this.__errors[a]),c},this)},setError:function(a,b){this.__errors[a]=b,this.trigger("validate:"+a,!(a in this.__errors),this.__errors[a])},errors:function(){return this.__errors},getError:function(a){return this.__errors[a]},asRecord:function(a){var b={},c=this.cls.scheme(),e=this.get_all_properties();a=a||{};var f=function(f){var g=c[f].tags||[],h={};d.iter(g,function(a){h[a]=!0});var i=!0;d.iter(a,function(a){i=i&&a in h},this),i&&(b[f]=e[f])};for(var g in e)g in c&&f.call(this,g);return b},setByTags:function(a,b){var c=this.cls.scheme();b=b||{};var e=function(e){var f=c[e].tags||[],g={};d.iter(f,function(a){g[a]=!0});var h=!0;d.iter(b,function(a){h=h&&a in g},this),h&&this.set(e,a[e])};for(var f in a)f in c&&e.call(this,f)},validation_exception_conversion:function(a){var b=a;if("instance_of"in a&&a.instance_of(e))b=a.source();else if(!("status_code"in b&&"data"in b))return a;return b.status_code()==f.HTTP_STATUS_PRECONDITION_FAILED&&b.data()&&(d.iter(b.data(),function(a,b){this.setError(b,a)},this),a=new g(this)),a}}},{_initializeScheme:function(){return{}},asRecords:function(a,b){return a.map(function(a){return a.asRecord(b)})},filterPersistent:function(a){var c={},d=this.scheme();for(var e in a)b.is_defined(d[e].persistent)&&!d[e].persistent||!b.is_defined(a[e])||(c[e]=a[e]);return c}},{scheme:function(){return this.__scheme=this.__scheme||this._initializeScheme(),this.__scheme}})}),a.define("module:Modelling.AssociatedProperties",["module:Modelling.SchemedProperties"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this,b),this.assocs=this._initializeAssociations();for(var c in this.assocs)this.__addAssoc(c,this.assocs[c])},__addAssoc:function(a,b){this[a]=function(){return b.execute.apply(b,arguments)}},_initializeAssociations:function(){return{}},destroy:function(){for(var b in this.assocs)this.assocs[b].destroy();a.destroy.call(this)},id:function(){return this.get(this.cls.primary_key())},hasId:function(){return this.has(this.cls.primary_key())}}},{primary_key:function(){return"id"},_initializeScheme:function(){var a={};return a[this.primary_key()]={type:"id",tags:["read"],after_set:null,persistent:!0},a}})}),a.define("module:Modelling.Table",["base:Class","base:Events.EventsMixin","base:Objs","base:Types","base:Iterators.MappedIterator"],function(b,c,d,e,f,g){return b.extend({scoped:g},[c,function(b){return{constructor:function(a,c,e){b.constructor.call(this),this.__store=a,this.__model_type=c,this.__options=d.extend({type_column:null,auto_create:!1,auto_update:!0,save_invalid:!1},e||{}),this.__store.on("insert",function(a){this.trigger("create",a)},this),this.__store.on("update",function(a,b){var c=a[this.primary_key()];this.trigger("update",c,b,a),this.trigger("update:"+c,b)},this),this.__store.on("remove",function(a){this.trigger("remove",a),this.trigger("remove:"+a)},this),"activeQuery"in this.__store&&(this.activeQuery=function(a,b){return this.__store.activeQuery(a,b||this)}),"unregisterQuery"in this.__store&&(this.unregisterQuery=function(a,b){return this.__store.unregisterQuery(a,b||this)})},modelClass:function(b){return b=b||this.__model_type,e.is_string(b)?a.getGlobal(b):b},newModel:function(a,b){b=this.modelClass(b);var c=new b(a,this);return this.__options.auto_create&&c.save(),c},materialize:function(a){if(!a)return null;var b=this.modelClass(this.__options.type_column&&a[this.__options.type_column]?this.__options.type_column:null);return new b(a,this,{newModel:!1})},options:function(){return this.__options},store:function(){return this.__store},findById:function(a){return this.__store.get(a).mapSuccess(this.materialize,this)},findBy:function(a){return this.allBy(a,{limit:1}).mapSuccess(function(a){return a.next()})},allBy:function(a,b){return this.__store.query(a,b).mapSuccess(function(a){return new f(a,function(a){return this.materialize(a)},this)},this)},primary_key:function(){return(e.is_string(this.__model_type)?a.getGlobal(this.__model_type):this.__model_type).primary_key()},all:function(a){return this.allBy({},a)},query:function(){return this.allBy.apply(this,arguments)},scheme:function(){return this.__model_type.scheme()},ensure_indices:function(){if(!("ensure_index"in this.__store))return!1;var a=this.scheme();for(var b in a)a[b].index&&this.__store.ensure_index(b);return!0}}}])}),a.define("module:Modelling.Associations.Association",["base:Class","base:Promise","base:Iterators"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b,c){a.constructor.call(this),this._model=b,this._options=c||{},c.delete_cascade&&b.on("remove",function(){this.__delete_cascade()},this)},__delete_cascade:function(){this.execute().success(function(a){for(a=c.ensure(a);a.hasNext();)a.next().remove({})},this)},execute:function(){if("__cache"in this)return b.create(this.__cache);var a=this._execute();return this._options.cached&&a.callback(function(a,b){this.__cache=a?null:b},this),a},invalidate:function(){delete this.__cache}}})}),a.define("module:Modelling.Associations.BelongsToAssociation",["module:Modelling.Associations.TableAssociation","base:Promise","base:Objs"],function(a,b,c,d){return a.extend({scoped:d},function(){return{_execute:function(){var a=this._model.get(this._foreign_key);return a?this._primary_key?this._foreign_table.findBy(c.objectBy(this._primary_key,a)):this._foreign_table.findById(a):b.value(null)}}})}),a.define("module:Modelling.Associations.ConditionalAssociation",["module:Modelling.Associations.Associations","base:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d){a.constructor.call(this,c,b.extend({conditional:function(){return!0}},d))},_execute:function(){var a=this.assoc();return a.execute.apply(a,arguments)},assoc:function(){return this._model.assocs[this._options.conditional(this._model)]}}})}),a.define("module:Modelling.Associations.HasManyAssociation",["module:Modelling.Associations.TableAssociation","base:Objs","base:Iterators.ArrayIterator"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{_id:function(){return this._primary_key?this._model.get(this._primary_key):this._model.id()},_execute:function(){return this.allBy()},execute:function(){return a.execute.call(this).mapSuccess(function(a){return new c(a)})},findBy:function(){return this._foreign_table.findBy(b.objectBy(this._foreign_key,this._id()))},allBy:function(a,c){return this._foreign_table.allBy(b.extend(b.objectBy(this._foreign_key,c?c:this._id(),a)))}}})}),a.define("module:Modelling.Associations.HasManyThroughArrayAssociation",["module:Modelling.Associations.HasManyAssociation","base:Promise","base:Objs"],function(a,b,c,d){return a.extend({scoped:d},{_execute:function(){var a=b.create(),d=b.and();return c.iter(this._model.get(this._foreign_key),function(a){d=d.and(this._foreign_table.findById(a))},this),d.forwardError(a).success(function(b){a.asyncSuccess(c.filter(b,function(a){return!!a}))}),a}})}),a.define("module:Modelling.Associations.HasManyViaAssociation",["module:Modelling.Associations.HasManyAssociation","base:Objs","base:Promise"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b,c,d,e,f,g){a.constructor.call(this,b,e,f,g),this._intermediate_table=c,this._intermediate_key=d},findBy:function(a){var d=c.create(),e=b.objectBy(this._intermediate_key,this._id());return this._intermediate_table.findBy(e).forwardError(d).success(function(c){if(c){var e=b.extend(b.clone(a,1),b.objectBy(this._foreign_table.primary_key(),c.get(this._foreign_key)));this._foreign_table.findBy(e).forwardCallback(d)}else d.asyncSuccess(null)},this),d},allBy:function(a,d){var e=c.create(),f=b.objectBy(this._intermediate_key,d?d:this._id());return this._intermediate_table.allBy(f).forwardError(e).success(function(d){for(var f=c.and();d.hasNext();){var g=d.next(),h=b.extend(b.clone(a,1),b.objectBy(this._foreign_table.primary_key(),g.get(this._foreign_key)));f=f.and(this._foreign_table.allBy(h))}f.forwardError(e).success(function(a){var c=[];b.iter(a,function(a){for(;a.hasNext();)c.push(a.next())}),e.asyncSuccess(c)},this)},this),e}}})}),a.define("module:Modelling.Associations.HasOneAssociation",["module:Modelling.Associations.TableAssociation","base:Objs"],function(a,b,c){return a.extend({scoped:c},{_execute:function(a){var c=a?a:this._primary_key?this._model.get(this._primary_key):this._model.id();return this._foreign_table.findBy(b.objectBy(this._foreign_key,c))}})}),a.define("module:Modelling.Associations.PolymorphicHasOneAssociation",["module:Modelling.Associations.Association","base:Objs"],function(b,c,d){return b.extend({scoped:d},function(b){return{constructor:function(a,c,d,e){b.constructor.call(this,a,e),this._foreign_table_key=c,this._foreign_key=d,e.primary_key&&(this._primary_key=e.primary_key)},_execute:function(b){var d=b?b:this._primary_key?this._model.get(this._primary_key):this._model.id(),e=a.getGlobal(this._model.get(this._foreign_table_key));return e.findBy(c.objectBy(this._foreign_key,d))}}})}),a.define("module:Modelling.Associations.TableAssociation",["module:Modelling.Associations.Association"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c,d,e){a.constructor.call(this,b,e),this._foreign_table=c,this._foreign_key=d}}})}),a.define("module:Modelling.Validators.ConditionalValidator",["module:Modelling.Validators.Validator","base:Types"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d){a.constructor.call(this),this.__condition=c,this.__validator=b.is_array(d)?d:[d]},validate:function(a,b){if(!this.__condition(a,b))return null;for(var c=0;c<this.__validator.length;++c){var d=this.__validator[c].validate(a,b);

if(null!==d)return d}return null}}})}),a.define("module:Modelling.Validators.EmailValidator",["module:Modelling.Validators.Validator","base:Strings"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b){a.constructor.call(this),this.__error_string=b?b:"Not a valid email address"},validate:function(a){return b.is_email_address(a)?null:this.__error_string}}})}),a.define("module:Modelling.Validators.LengthValidator",["module:Modelling.Validators.Validator","base:Types","base:Objs"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b){a.constructor.call(this),b=c.extend({min_length:null,max_length:null,error_string:null},b),this.__min_length=b.min_length,this.__max_length=b.max_length,this.__error_string=b.error_string,this.__error_string||(null!==this.__min_length?this.__error_string=null!==this.__max_length?"Between "+this.__min_length+" and "+this.__max_length+" characters":"At least "+this.__min_length+" characters":null!==this.__max_length&&(this.__error_string="At most "+this.__max_length+" characters"))},validate:function(a){return null!==this.__min_length&&(!a||a.length<this.__min_length)?this.__error_string:null!==this.__max_length&&a.length>this.__max_length?this.__error_string:null}}})}),a.define("module:Modelling.Validators.PresentValidator",["module:Modelling.Validators.Validator","base:Types"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(b){a.constructor.call(this),this.__error_string=b?b:"Field is required"},validate:function(a){return b.is_null(a)||""===a?this.__error_string:null}}})}),a.define("module:Modelling.Validators.UniqueValidator",["module:Modelling.Validators.Validator"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b,c){a.constructor.call(this),this.__key=b,this.__error_string=c?c:"Key already present"},validate:function(a,b){var c={};return c[this.__key]=a,b.table().findBy(c).mapSuccess(function(a){return!a||!b.isNew()&&b.id()==a.id()?null:this.__error_string},this)}}})}),a.define("module:Modelling.Validators.Validator",["base:Class"],function(a,b){return a.extend({scoped:b},{validate:function(){return null}})})}).call(Scoped);